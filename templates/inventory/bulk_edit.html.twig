{% extends 'base.html.twig' %}

{% block title %}Bulk Edit Inventories{% endblock %}

{% block body %}
<style>
    body { background-color: #f9fafb; }
    .bulk-card {
        background: #fff;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        padding: 2rem;
    }
    .inventory-badge {
        background: #f3f4f6;
        color: #111827;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        border: 1px solid #e5e7eb;
        margin-right: 5px;
        margin-bottom: 5px;
        display: inline-block;
    }
    .section-label {
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        color: #9ca3af;
        letter-spacing: 0.05em;
        margin-bottom: 1.5rem;
        display: block;
    }
</style>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <h1 class="fw-bold text-dark mb-4">Bulk Edit Inventories</h1>

            <div class="bulk-card mb-4">
                <span class="section-label">Selected Inventories ({{ inventories|length }})</span>
                <div>
                    {% for inv in inventories %}
                        <div class="inventory-badge">
                            <div class="inventory-badge">
                                <span class="fw-bold">{{ inv.category.name ?? 'No Category' }}</span>: {{ inv.title }}
                                <small class="text-muted">[{{ inv.tags|join(', ') }}]</small>
                                <input type="hidden" name="ids[]" value="{{ inv.id }}" form="bulk-update-form">
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="bulk-card">
                <form id="bulk-update-form" method="POST" action="{{ path('app_inventory_bulk_update_save') }}">
                    <span class="section-label">Update Fields</span>
                    <p class="text-muted small mb-4">Leave fields empty if you do not want to change their current values.</p>

                    {% if not isSingle %}
                        <div class="alert alert-warning border-0 shadow-sm d-flex align-items-center mb-4" style="border-radius: 10px;">
                            <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
                            <div>
                                <strong>Bulk Edit Warning:</strong> You are editing {{ inventories|length }} inventories.
                                Only fields you modify will be updated across all selected records.
                            </div>
                        </div>
                    {% endif %}

                    <div class="row g-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold small">Category</label>
                            <select name="category" class="form-select">
                                <option value="" {% if not isSingle %}selected{% endif %}>Keep Original</option>
                                {% for cat in categories %}
                                    <option value="{{ cat.id }}"
                                        {% if isSingle and inventoryData.category and inventoryData.category.id == cat.id %}selected{% endif %}>
                                        {{ cat.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold small">Tags</label>
                            <input type="text" name="tags" class="form-control" value="{{ isSingle ? inventoryData.tags|join(', ') : '' }}" placeholder="e.g. electronics, home, storage">
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold small">Visibility</label>
                            <select name="is_public" class="form-select">
                                <option value="" {% if not isSingle %}selected{% endif %}>Keep Original</option>
                                <option value="1" {% if isSingle and inventoryData.isPublic == true %}selected{% endif %}>Public</option>
                                <option value="0" {% if isSingle and inventoryData.isPublic == false %}selected{% endif %}>Private</option>
                            </select>
                        </div>

                        <div class="col-md-12">
                            <label class="form-label fw-bold small">Description</label>
                            <textarea name="description" class="form-control" rows="3" placeholder="New Description">{{ isSingle ? inventoryData.description : '' }}</textarea>
                        </div>
                    </div>

                    <div class="mt-5 pt-4 border-top d-flex justify-content-between">
                        <a href="{{ path('app_my_inventories') }}" class="btn btn-outline-secondary px-4">Cancel</a>
                        <button type="submit" class="btn btn-dark px-5 fw-bold">Update All Selected Inventories</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}