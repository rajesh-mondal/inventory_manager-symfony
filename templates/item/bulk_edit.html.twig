{% extends 'base.html.twig' %}

{% block title %}Bulk Edit Items{% endblock %}

{% block body %}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <h1 class="fw-bold text-dark mb-4">{{ 'bulk_item_edit.title'|trans }}</h1>

            <div class="bulk-card mb-4">
                <span class="section-label">
                    {{ 'bulk_item_edit.selected_count'|trans({'%count%': items|length}) }}
                </span>
                <div>
                    {% for item in items %}
                        <div class="item-badge">
                            <span class="fw-bold">{{ item.customId }}</span>: {{ item.name }}
                            <input type="hidden" name="item_ids[]" value="{{ item.id }}" form="bulk-update-form">
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="bulk-card">
                <form id="bulk-update-form" method="POST" action="{{ path('app_item_bulk_update') }}">
                    <span class="section-label">{{ 'edit_inventory.update_fields'|trans }}</span>
                    <p class="text-muted small mb-4">{{ 'edit_inventory.bulk_help'|trans }}</p>

                    {% if not isSingle %}
                        <div class="alert alert-warning border-0 shadow-sm d-flex align-items-center mb-4" style="border-radius: 10px;">
                            <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
                            <div>
                                <strong>{{ 'edit_inventory.bulk_warning_title'|trans }}</strong>
                                    {{ 'bulk_item_edit.warning_body'|trans({'%count%': items|length}) }}
                            </div>
                        </div>
                    {% endif %}

                    <div class="row g-4">
                        {% for type in ['String', 'Int', 'Bool', 'Text'] %}
                            {% for i in 1..3 %}
                                {% set stateMethod = 'custom' ~ type ~ i ~ 'State' %}
                                {% set nameMethod = 'custom' ~ type ~ i ~ 'Name' %}
                                {% set valProperty = type|lower ~ 'Val' ~ i %}

                                {% if attribute(inventory, stateMethod) %}
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold small">{{ attribute(inventory, nameMethod) }}</label>

                                        {% set currentVal = isSingle ? attribute(itemData, valProperty) : '' %}

                                        {% if type == 'String' %}
                                            <input type="text" name="custom_string{{ i }}" class="form-control" value="{{ currentVal }}">
                                        {% elseif type == 'Int' %}
                                            <input type="number" name="custom_int{{ i }}" class="form-control" value="{{ currentVal }}">
                                        {% elseif type == 'Text' %}
                                            <textarea name="custom_text{{ i }}" class="form-control" rows="2">{{ currentVal }}</textarea>
                                        {% elseif type == 'Bool' %}
                                            <select name="custom_bool{{ i }}" class="form-select">
                                                <option value="" {% if not isSingle %}selected{% endif %}>{{ 'edit_inventory.keep_original'|trans }}</option>
                                                <option value="1" {% if isSingle and currentVal == true %}selected{% endif %}>{{ 'bulk_item_edit.yes_true'|trans }}</option>
                                                <option value="0" {% if isSingle and currentVal == false %}selected{% endif %}>{{ 'bulk_item_edit.no_false'|trans }}</option>
                                            </select>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </div>

                    <div class="mt-5 pt-4 border-top d-flex justify-content-between">
                        <a href="{{ path('app_inventory_show', {id: inventory.id}) }}"
                            class="btn btn-outline-secondary px-4">
                            {{ 'buttons.cancel'|trans }}
                        </a>
                        <button type="submit"
                            class="btn btn-dark px-5 fw-bold">
                            {{ 'edit_inventory.update_all'|trans }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}